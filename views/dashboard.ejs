<%- include('./partials/messages') %>

<style>
    .stat-card {
        border-left: 5px solid var(--stat-color, #007bff);
        transition: transform 0.2s ease;
    }
    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
</style>

<div class="row mt-4">
    <div class="col-12">
        <div class="p-4 rounded shadow bg-white">
            <h1 class="display-5 mb-1">Welcome, <%= user.name %>!</h1>
            <p class="lead text-muted mb-4">
                You are logged in as **<%= user.role %>** for **<%= (typeof company !== 'undefined' && company) ? company.name : 'Loading Company...' %>** (Default Currency: <%= (typeof company !== 'undefined' && company) ? company.defaultCurrency : 'N/A' %>).
            </p>
            <hr>
        </div>
    </div>
</div>

<% 
    if (typeof stats !== 'undefined' && stats && (user.role === 'Admin' || user.role === 'Manager')) { 
%>
    <h3 class="mt-4 mb-3 text-secondary">Company Overview</h3>
    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stat-card shadow-sm" style="--stat-color: #007bff;">
                <div class="card-body">
                    <h5 class="card-title text-muted">Total Users</h5>
                    <p class="h1 mb-0"><%= stats.totalUsers %></p>
                    <small class="text-success"><%= stats.totalManagers %> Managers, <%= stats.totalEmployees %> Employees</small>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stat-card shadow-sm" style="--stat-color: #ffc107;">
                <div class="card-body">
                    <h5 class="card-title text-muted">Pending Expenses</h5>
                    <p class="h1 text-warning mb-0"><%= stats.pendingApprovals %></p>
                    <small class="text-muted">Awaiting action</small>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stat-card shadow-sm" style="--stat-color: #17a2b8;">
                <div class="card-body">
                    <h5 class="card-title text-muted">Total Claims</h5>
                    <p class="h1 mb-0"><%= stats.totalExpenses %></p>
                    <small class="text-muted">Submitted company-wide</small>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stat-card shadow-sm" style="--stat-color: #28a745;">
                <div class="card-body">
                    <h5 class="card-title text-muted">Total Claims Value</h5>
                    <p class="h3 mb-0 text-success">-- N/A --</p>
                     <small class="text-muted">In <%= (typeof company !== 'undefined' && company) ? company.defaultCurrency : 'N/A' %></small>
                </div>
            </div>
        </div>
    </div>
<% } %>


<h3 class="mt-4 mb-3 text-secondary"><%= user.role %> Actions</h3>
<div class="row">
    
    <% if (user.role === 'Admin') { %>
        <div class="col-md-4 mb-3">
            <div class="card bg-light shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title text-primary">User Management</h5>
                    <p class="card-text">Create and manage employees and managers.</p>
                    <a href="/admin/add/employee" class="btn btn-primary">Add Employee</a>
                    <a href="/admin/add/manager" class="btn btn-primary">Add Manager</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
             <div class="card bg-light shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title text-info">Assign Manager</h5>
                    <p class="card-text">Assign a manager to an employee.</p>
                    <a href="/admin/assign-manager" class="btn btn-info">Assign Manager</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card bg-light shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title text-info">Oversight</h5>
                    <p class="card-text">Quick access to all pending company expenses.</p>
                    <a href="/expenses/pending" class="btn btn-info">Review Pending (<%= (typeof stats !== 'undefined' && stats) ? stats.pendingApprovals : 'N/A' %>)</a>
                </div>
            </div>
        </div>

    <% } else if (user.role === 'Manager') { %>
        <% } else { %>
        <% } %>
</div>


<% if (user.role === 'Admin') { %>
    <div class="row mt-4">
        <div class="col-md-6">
            <h3 class="text-secondary">Managers</h3>
            <div class="card shadow-sm">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <% managers.forEach(manager => { %>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <%= manager.name %>
                                <span class="badge bg-primary rounded-pill"><%= manager.email %></span>
                            </li>
                        <% }) %>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <h3 class="text-secondary">Employees</h3>
            <div class="card shadow-sm">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <% employees.forEach(employee => { %>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <%= employee.name %>
                                <span class="badge bg-secondary rounded-pill"><%= employee.email %></span>
                            </li>
                        <% }) %>
                    </ul>
                </div>
            </div>
        </div>
    </div>
<% } %>